<p><span><strong>Keywords:</strong></span> computational biology, evolution, phylogenetics, prior choice</p>
<h1 id="introduction">Introduction</h1>
<p>The computational tools that are currently available go beyond the wildest imagination of those living four decades ago. Advances in computational power allowed the first cladograms to be inferred from DNA alignments in 1981 (<span class="citation"></span>), and the first Bayesian tools emerged in 1996 (<span class="citation"></span>), providing unprecedented flexibility in the setup of a phylogenetic model.</p>
<p>Currently, the most popular Bayesian phylogenetics tools are BEAST (<span class="citation"></span>) and its successor BEAST2 (<span class="citation"></span>), MrBayes (<span class="citation"></span>) and RevBayes (<span class="citation"></span>). They allow to incorporate known or hypothesized structure of a phylogenetic tree-to-be-inferred through model priors. From these priors and an alignment of DNA, RNA or protein sequences, they create a posterior distribution of parameter estimates (of the models used as a prior) and phylogenies, in which more probable combinations are represented more often. Each of these tools use efficient tree sampling routines to rapidly create an informative posterior.</p>
<p>These model priors in Bayesian phylogenetic reconstruction can be grouped in three groups: (1) site model, specifying nucleotide substitutions, (2) clock model, specifying the rate of mutation per lineage in time, and (3) tree prior, embodying the speciation model underlying branching events (speciation) and branch termination (extinction). The choice of a wrong site model (<span class="citation"></span>), clock model (<span class="citation"></span>) or tree prior (<span class="citation"></span>) is known to affect the posterior.</p>
<p>Current phylogenetic tools use tree priors that assume speciation is instantaneous, whilst we know that, speciation is often a gradual process. The (constant-rate) birth-death (BD) model is a commonly used tree prior, but it ignores this temporal aspect of speciation. The protracted birth-death (PBD) model, an extension of the BD model, does incorporate the idea that speciation takes time. In this model, a branching event does not give rise to a new species, but to a new species-to-be, called an incipient species. Such an incipient species may go extinct, finish its speciation to become a good species, or give rise to new incipient species. Protracted speciation may explain observed declines in lineage accumulation (<span class="citation"></span>).</p>
<p>Unfortunately, a tree prior according to this model, providing the probability of a species tree under the PBD model, is unavailable in current Bayesian phylogenetic tools. Whilst an approximate formula for this probability has been derived (<span class="citation"></span>) and the approximation is very good (<span class="citation"></span>), it has not been implemented as tree prior yet. There are various reasons for this. First, the computation of this probability involves solving a set of non-linear differential equations, and while this computation is quite fast, it still takes much more time than the corresponding probability of the BD model which is a simple analytical formula. In a Bayesian MCMC chain, the tree prior probability must be calculated many times, and hence the total computation will take considerably longer with a PBD tree prior. Furthermore, the approximate probability is a probability for the species tree assuming an underlying incipient species tree. It can be safely used as tree prior when only one individual per species is sampled, but if one has multiple samples per species -which is currently often the case- the methods to account for this such as the multi-species coalescent (<span class="citation"></span>) may not be compatible with the underlying incipient species tree. More precisely, the phylogeny under the PBD model may contain paraphylies, while the multi-species coalescent was developed exactly to avoid this by explaining them as incomplete lineage sorting. Because of these paraphylies there is no such thing as a true species tree in the PBD model. To get a species-level tree one must sample one incipient species per species. Which incipient species is sampled may therefore have an impact on the species tree.</p>
<p>Here we aim to explore the effect of using the BD prior on PBD simulated phylogenies, taking into account possible sampling effects. In brief, we simulate protracted phylogenies using the PBD process, from which we sample a species tree in two very different ways. Given this species tree, we simulate a DNA sequence alignment. Then, we use BEAST2 on these alignments to infer a posterior of phylogenies, using a BD prior. We quantify the difference between the (BD) posterior phylogenies and the simulated (PBD) species tree.</p>
<h1 id="methods-but-we-are-not-allowed-to-keep-this-header">Methods (but we are not allowed to keep this header)</h1>
<p>The PBD model has five biological parameters (see [table:parameters]), which we explore in a factorial fashion, excluding some combinations. We only simulate a PBD process for phylogenies in which speciation initiation exceeds extinction rate (<span class="math inline"><em>b</em><sub><em>i</em></sub> &gt; <em>μ</em><sub><em>i</em></sub></span> and <span class="math inline"><em>b</em><sub><em>g</em></sub> &gt; <em>μ</em><sub><em>g</em></sub></span>), and in which the expected number of extant good species is less than 1000. As the analytic solution for the expected number of extant good species is too complex to be derived (<span class="citation"></span>), we a numerical approximation <strong>NOTE: I will suggest somewhen/somewhere else if this may become a function of the PBD package</strong>. We use 1000 good species as a threshold, to prevent overly taxon-poor and taxon-rich phylogenies respectively. The parameter values chosen are based on the parameter sets used by <span class="citation"></span>, as these parameters were shown to result in reasonably sized phylogenies and using the same set allows us to compare results. For the speciation initiation rates of good and incipient species, <span class="math inline"><em>b</em><sub><em>g</em></sub></span> and <span class="math inline"><em>b</em><sub><em>i</em></sub></span> respectively, we use <span class="math inline">0.1</span>, <span class="math inline">0.5</span> and <span class="math inline">1.0</span> speciation initiation events per good/incipient species per time unit. The speciation completion rates used are <span class="math inline">0.1</span>, <span class="math inline">0.3</span>, <span class="math inline">1.0</span> and <span class="math inline">10<sup>9</sup></span> speciation completion events per (incipient species) species per time unit. We used <span class="math inline">10<sup>9</sup> ≈ ∞</span> to mimic the BD model, because the PBD model reduces to the BD model for <span class="math inline"><em>λ</em> = ∞</span>. This allows us to measure the baseline error, which is the difference between inferred tree and true species tree that arises purely due to noise because the generating model and the model used in inference are identical. The extinction rates of good and incipient species, <span class="math inline"><em>μ</em><sub><em>g</em></sub></span> and <span class="math inline"><em>μ</em><sub><em>i</em></sub></span> respectively, that we used are <span class="math inline">0.0</span>, <span class="math inline">0.1</span>, <span class="math inline">0.2</span> and <span class="math inline">0.4</span> extinction events per good/incipient species per time unit.</p>
<p>From each biological parameter set, we simulated a protracted birth-death tree, using the PBD package (<span class="citation"></span>) in the R programming language (<span class="citation"></span>), all with a crown age of 15 million years. Each protracted birth-death tree uses a different random number generatior seed, which makes all runs independent, resulting in a balanced data set. <strong>NOTE: Rampal suggested to re-use same seeds. I see in Progress Report of week 50 of 2015 this was already abandoned in favor of a more smooth data set. I do check that nLTT values of multiple random alignments on the same species tree result in same distribution, but that may not be written down here</strong></p>
<p>From each incipient species tree, we construct a species tree, by sampling one incipient/good species per good species. For example, when an incipient species branched off from its mother lineage, both of these subspecies are recognized as representing the species, and hence both can be picked as an (equally good) representative of the species. Here, we use three sampling scenario’s, in which we pick the representative randomly or in such a way that this results in either the shortest or longest branch lengths. See the supplementary information for a visualization of these sampling methods.</p>
<p>Based on the sampled species tree, we simulate a DNA alignment that has the same history as this species tree, using the phangorn package (<span class="citation"></span>). We assume that the nucleotides of the DNA alignment follow a Jukes-Cantor (<span class="citation"></span>) nucleotide substitution model, in which all nucleotide-to-nucleotide transitions are equally likely. In our Bayesian inference (see below) we use the same site model as the (obviously correct) site model prior. One could explore other substitution models in the simulations and in the Bayesian inference, but we chose this simple model because we are primarily interested in the effect of the choice of tree prior. If anything, our results are conservative: with a more complex substitution model, there will be more noise and hence our inference error will increase. We set the mutation rate in such a way to maximize the information contained in the alignment. To do so, we set the mutation rate such that we expect on average one (possibly silent) mutation per nucleotide between crown age and present, which equates to <span class="math inline">$\frac{1}{15}$</span> mutations per million years. The DNA sequence length is chosen to provide a resolution of <span class="math inline">10<sup>3</sup></span> years, that is, to have one expected nucleotide change per <span class="math inline">10<sup>3</sup></span> years per lineage on average. As one nucleotide is expected to have on average one (possibly silent) mutation per 15 million years, <span class="math inline">15 ⋅ 10<sup>3</sup></span> nucleotides result in 1 mutation per alignment per <span class="math inline">10<sup>3</sup></span> years (which is coincidentally the same as <span class="citation"></span>). The simulation of these DNA aligments follows a strict clock model, which we will specify as the known clock model prior in the Bayesian inference.</p>
<p>From an alignment, we run a Bayesian analysis and create a posterior distribution of trees and parameters using the babette (<span class="citation"></span>) package that sets the input parameters similar to BEAUti 2 and then runs BEAST2. For our site model, we assume a Jukes-Cantor nucleotide substitution model, as used in the simulation of the alignment. For our clock model, we assume a strict clock with the same fixed rate as used in the simulation of the alignment. The tree prior assumed in inference is the BD model, because studying the effect of this assumption is the goal of this study. We assumed an MRCA prior with a tight normal distribution around the crown age, by choosing the crown age as mean, and a standard deviation of <span class="math inline">0.5 ⋅ 10<sup>−3</sup></span> time units, resulting in 95% of the crown ages used have the same resolution (of <span class="math inline">10<sup>−3</sup></span> time units) as the alignment. We ran the MCMC chain to generate 1111 states, of which we removed the first 10% (also called the ’burn-in’). Of the remaining 1000 MCMC states, the effective sample size (ESS) of the posterior <strong>NOTE: there is a parameter estimate called ’posterior’. I choose to pick that one, and I assume it is the wiser choice over ’prior’ and parameter estimates. Agree?</strong> must at least be 200 for a strong enough inference (<span class="citation"></span>). An ESS can be increased by increasing the number of samples or decreasing the autocorrelation between samples. Would the ESS be less than 200, we decrease autocorrelation by doubling the MCMC sampling interval of that simulation, until the ESS exceeds 200.</p>
<p>We compared each posterior phylogeny to the (sampled) species tree by the nLTT statistic (<span class="citation"></span>), using the nLTT package (<span class="citation"></span>). The nLTT statistic equals the area between the normalized lineages-through-time-plots of two phylogenies, which has a range from zero (for identical phylogenies) to one. We use inference error and nLTT statistic interchangeably. Comparing the one (sampled) species tree with each of the posterior species trees yields a distribution of nLTT statistics.</p>
<p>We produce two data sets as a comma-seperated file. We set the number of replicates for each parameter combination such, that this file and a possible copy can be handled in R’s memory. Each row will then contain a parameter set and the generated nLTT statistics (see [table:specs] for the exact data specification). The abovementioned memory constraints allows for <span class="math inline">2 ⋅ 10<sup>3</sup></span> rows. With 48 <strong>[NOTE: recalculate]</strong> combinations of biological parameter, there will be 168 <strong>[NOTE: recalculate]</strong> replicates per parameter set.</p>
<p>For both data sets, we plot the nLTT statistics distribution per parameter set using a violin plot, as such a plot maintains information about the distribution. To simplify the interpretation of these plots, only nLTT statistics distribution are shown for <span class="math inline"><em>λ</em><sub><em>g</em></sub> = <em>λ</em><sub><em>i</em></sub></span> and <span class="math inline"><em>μ</em><sub><em>g</em></sub> = <em>μ</em><sub><em>i</em></sub></span>.</p>
<h1 id="results">Results</h1>
<div class="figure">
<img src="fig_nltt_stats_per_setup.png" alt=" nLTT statistic distribution per biological parameter set, using the balanced data set " style="width:80.0%" />
<p class="caption"> nLTT statistic distribution per biological parameter set, using the balanced data set </p>
</div>
<div class="figure">
<img src="fig_sampling.png" alt=" nLTT statistic distribution per biological parameter set per sampling regime, using the data set conditioned on sampling regime having an effect " style="width:80.0%" />
<p class="caption"> nLTT statistic distribution per biological parameter set per sampling regime, using the data set conditioned on sampling regime having an effect </p>
</div>
<h1 id="glossary">Glossary</h1>
<table>
<caption> Glossary [NOTE: this is requested by the journal] <span data-label="table:glossary"></span></caption>
<thead>
<tr class="header">
<th align="left">Term</th>
<th align="left">Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Phylogenetics</td>
<td align="left">The inference of evolutionary relationships of groups of organisms using genetics</td>
</tr>
<tr class="even">
<td align="left">Model prior</td>
<td align="left">Knowledge or assumptions about the ontogeny of evolutionary histories</td>
</tr>
<tr class="odd">
<td align="left">Posterior</td>
<td align="left">A collection of phylogenies and parameter estimates, in which more probable combinations (determined by the data and the model prior) are presented more frequently</td>
</tr>
<tr class="even">
<td align="left">Protracted speciation</td>
<td align="left">The process in which speciation takes two events to complete: a speciation-initiation event and a speciation-completion event</td>
</tr>
<tr class="odd">
<td align="left">Speciation initiation</td>
<td align="left">The start of a speciation event creating an incipient species</td>
</tr>
<tr class="even">
<td align="left">Speciation completion</td>
<td align="left">The end of a speciation event, in which an incipient species is recognized as a good species</td>
</tr>
</tbody>
</table>
<h1 id="acknowledgements">Acknowledgements</h1>
<p><strong>[NOTE: journal does not request for this. Suggest to remove, but how to acknowledge Peregrine otherwise?]</strong> We would like to thank the Center for Information Technology of the University of Groningen for their support and for providing access to the Peregrine high performance computing cluster.</p>
<h1 id="authors-contributions">Authors’ contributions</h1>
<p><strong>[NOTE: journal does not request for this]</strong> RSE conceived the idea for this experiment. RJCB created and tested the experiment, and wrote the first draft of the manuscript. RSE contributed substantially to revisions.</p>
<table>
<caption> Overview of the 12 simulation parameters. Above the horizontal line is the biological parameter set. Sampling method <span class="math inline"><em>M</em></span> is random for the general data set. For the data set exploring the effect of sampling, MRCA is used for odd values of <span class="math inline"><em>R</em><sub><em>i</em></sub></span>, and MDCA is used for even values of <span class="math inline"><em>R</em><sub><em>i</em></sub></span>. <span class="math inline"><em>R</em><sub><em>i</em></sub></span> is 1 for the first simulation, 2 for the next, etcetera. <span data-label="table:parameters"></span></caption>
<thead>
<tr class="header">
<th align="left">Parameter</th>
<th align="left">Description</th>
<th align="left">Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><span class="math inline"><em>b</em><sub><em>g</em></sub></span></td>
<td align="left">Speciation initiation rate of a good species</td>
<td align="left">0.1, 0.5, 1.0</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline"><em>b</em><sub><em>i</em></sub></span></td>
<td align="left">Speciation initiation rate of an incipient species</td>
<td align="left">0.1, 0.5, 1.0</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline"><em>λ</em></span></td>
<td align="left">Speciation completion rate</td>
<td align="left">0.1, 0.3, 1.0, <span class="math inline">∞</span></td>
</tr>
<tr class="even">
<td align="left"><span class="math inline"><em>μ</em><sub><em>g</em></sub></span></td>
<td align="left">Extinction rate of a good species</td>
<td align="left">0.0, 0.1, 0.2, 0.4</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline"><em>μ</em><sub><em>i</em></sub></span></td>
<td align="left">Extinction rate of an incipient species</td>
<td align="left">0.0, 0.1, 0.2, 0.4</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline"><em>t</em><sub><em>c</em></sub></span></td>
<td align="left">Crown age</td>
<td align="left">15</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline"><em>σ</em><sub><em>c</em></sub></span></td>
<td align="left">Standard deviation around crown age</td>
<td align="left">0.001</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline"><em>M</em></span></td>
<td align="left">Sampling method</td>
<td align="left">’shortest’, ’longest’ or random</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline"><em>r</em></span></td>
<td align="left">Mutation rate</td>
<td align="left"><span class="math inline">$\frac{1}{15}$</span></td>
</tr>
<tr class="even">
<td align="left"><span class="math inline"><em>l</em><sub><em>a</em></sub></span></td>
<td align="left">DNA alignment length</td>
<td align="left"><span class="math inline">15<em>K</em></span></td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline"><em>f</em><sub><em>i</em></sub></span></td>
<td align="left">MCMC sampling interval</td>
<td align="left">1K or more</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline"><em>R</em><sub><em>i</em></sub></span></td>
<td align="left">RNG seed incipient tree</td>
<td align="left">1 to 20K</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline"><em>R</em><sub><em>a</em></sub></span></td>
<td align="left">RNG seed alignment simulation</td>
<td align="left"><span class="math inline"><em>R</em><sub><em>i</em></sub></span></td>
</tr>
<tr class="even">
<td align="left"><span class="math inline"><em>R</em><sub><em>b</em></sub></span></td>
<td align="left">RNG seed BEAST2</td>
<td align="left"><span class="math inline"><em>R</em><sub><em>i</em></sub></span></td>
</tr>
</tbody>
</table>
<table>
<caption> Specification of the data sets. Each row will contain one experiment, where the columns contain parameters, measurements and diagnostics. This table displays the content of the columns. <span class="math inline"><em>n</em></span> denotes the number of columns a certain item will occupy, resulting in a table of 1023 columns and 20K rows. <span data-label="table:specs"></span></caption>
<thead>
<tr class="header">
<th align="left"><span class="math inline"><em>n</em></span></th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><span class="math inline">12</span></td>
<td align="left">simulation parameters, see table [table:parameters]</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">1000</span></td>
<td align="left">nLTT statistic values</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">11</span></td>
<td align="left">ESSes of all parameters estimated by BEAST2 (see specs below)</td>
</tr>
</tbody>
</table>
<table>
<caption> Overview of the 11 BEAST2 estimated parameters <span data-label="table:estimated_parameters"></span></caption>
<thead>
<tr class="header">
<th align="left">#</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">posterior</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">likelihood</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">prior</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">treeLikelihood</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">TreeHeight</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="left">BirthDeath</td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="left">BDBirthRate</td>
</tr>
<tr class="even">
<td align="left">8</td>
<td align="left">BDDeathRate</td>
</tr>
<tr class="odd">
<td align="left">9</td>
<td align="left">logP.mrca</td>
</tr>
<tr class="even">
<td align="left">10</td>
<td align="left">mrcatime</td>
</tr>
<tr class="odd">
<td align="left">11</td>
<td align="left">clockRate</td>
</tr>
</tbody>
</table>
